# 入門指南

本指南說明在安裝並初始化 OpenSpec 後它如何運作。有關安裝指示，請參閱 [主 README](../README.md#quick-start)。

## 它如何運作

OpenSpec 協助您與您的 AI 程式碼助理在撰寫任何程式碼之前，就「要建構什麼」達成共識。工作流程遵循一個簡單的模式：

```
┌────────────────────┐
│ 開始一個變更         │  /opsx:new
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│ 建立成品             │  /opsx:ff 或 /opsx:continue
│ (提案、規格、        │
│  設計、任務)         │
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│ 實作任務             │  /opsx:apply
│ (AI 撰寫程式碼)      │
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│ 封存並合併           │  /opsx:archive
│ 規格                │
└────────────────────┘
```

## OpenSpec 建立的內容

執行 `openspec init` 後，您的專案將具有以下結構：

```
openspec/
├── specs/              # 單一事實來源（您的系統行為）
│   └── <domain>/
│       └── spec.md
├── changes/            # 提議的更新（每個變更一個資料夾）
│   └── <change-name>/
│       ├── proposal.md
│       ├── design.md
│       ├── tasks.md
│       └── specs/      # 差異規格（正在變更的內容）
│           └── <domain>/
│               └── spec.md
└── config.yaml         # 專案設定（選用）
```

**兩個關鍵目錄：**

- **`specs/`** - 單一事實來源。這些規格描述了您的系統目前的行為方式。按領域組織（例如：`specs/auth/`、`specs/payments/`）。

- **`changes/`** - 提議的修改。每個變更都有自己的資料夾，其中包含所有相關成品。當變更完成時，其規格會合併到主 `specs/` 目錄中。

## 瞭解成品

每個變更資料夾都包含引導工作的成品：

| 成品          | 用途                                          |
| ------------- | --------------------------------------------- |
| `proposal.md` | 「為什麼」和「做什麼」 - 捕捉意圖、範圍和方法 |
| `specs/`      | 顯示 ADDED/MODIFIED/REMOVED 需求的差異規格    |
| `design.md`   | 「如何做」 - 技術方法和架構決策               |
| `tasks.md`    | 帶有複選框的實作檢查清單                      |

**成品相互建構：**

```
  提案 ──► 規格 ──► 設計 ──► 任務 ──► 實作
   ▲        ▲       ▲                │
   └────────┴───────┴────────────────┘
            隨著學習更新
```

在實作過程中，隨著您瞭解到更多資訊，您可以隨時回頭完善之前的成品。

## 差異規格 (Delta Specs) 如何運作

差異規格是 OpenSpec 中的核心概念。它們顯示相對於目前規格的變更內容。

### 格式

差異規格使用章節來指示變更類型：

```markdown
# Auth 差異

## 新增 (ADDED) 需求

### 需求：雙重身份驗證
系統必須 (MUST) 在登入期間要求第二因素。

#### 情境：需要 OTP
- 假設 (GIVEN) 使用者已啟用 2FA
- 當 (WHEN) 使用者提交有效憑證時
- 那麼 (THEN) 呈現 OTP 挑戰

## 修改 (MODIFIED) 需求

### 需求：工作階段逾時
系統應 (SHALL) 在閒置 30 分鐘後讓工作階段過期。
(先前為：60 分鐘)

#### 情境：閒置逾時
- 假設 (GIVEN) 一個已驗證的工作階段
- 當 (WHEN) 30 分鐘沒有活動時
- 那麼 (THEN) 工作階段失效

## 移除 (REMOVED) 需求

### 需求：記住我
(已被棄用，改用 2FA)
```

### 封存時會發生什麼

當您封存一個變更時：

1. **新增 (ADDED)** 的需求會附加到主規格末尾。
2. **修改 (MODIFIED)** 的需求會替換現有版本。
3. **移除 (REMOVED)** 的需求會從主規格中刪除。

變更資料夾會移動到 `openspec/changes/archive/` 以保留稽核歷史。

## 範例：您的第一個變更

讓我們逐步完成為應用程式新增深色模式的過程。

### 1. 開始變更

```
您：/opsx:new add-dark-mode

AI： 已建立 openspec/changes/add-dark-mode/
     準備好建立：proposal
```

### 2. 建立成品

使用 `/opsx:ff` (快進) 一次建立所有規劃成品：

```
您：/opsx:ff

AI： 正在為 add-dark-mode 建立成品...
     ✓ proposal.md — 為什麼我們要做這個，正在變更什麼
     ✓ specs/       — 需求和情境
     ✓ design.md    — 技術方法
     ✓ tasks.md     — 實作檢查清單
     準備好實作！
```

### 3. 建立的內容

**proposal.md** - 捕捉意圖：

```markdown
# 提案：新增深色模式

## 意圖
使用者要求提供深色模式選項，以減少夜間使用時的眼睛疲勞。

## 範圍
- 在設定中新增主題切換按鈕
- 支援系統偏好偵測
- 將偏好儲存在 localStorage 中

## 方法
使用 CSS 自訂屬性進行佈景主題設定，並使用 React context 進行狀態管理。
```

**specs/ui/spec.md** - 顯示新需求的差異：

```markdown
# UI 差異

## 新增 (ADDED) 需求

### 需求：主題選擇
系統應 (SHALL) 允許使用者在亮色和深色主題之間進行選擇。

#### 情境：手動切換
- 假設 (GIVEN) 使用者在任何頁面上
- 當 (WHEN) 使用者點擊主題切換按鈕時
- 那麼 (THEN) 主題立即切換
- 並且 (AND) 偏好在不同工作階段之間保持不變

#### 情境：系統偏好
- 假設 (GIVEN) 使用者沒有儲存的偏好
- 當 (WHEN) 應用程式載入時
- 那麼 (THEN) 使用系統偏好的配色方案
```

**tasks.md** - 實作檢查清單：

```markdown
# 任務

## 1. 主題基礎設施
- [ ] 1.1 建立具有亮/暗狀態的 ThemeContext
- [ ] 1.2 為顏色新增 CSS 自訂屬性
- [ ] 1.3 實作 localStorage 持久化

## 2. UI 元件
- [ ] 2.1 建立 ThemeToggle 元件
- [ ] 2.2 在設定頁面新增切換按鈕
- [ ] 2.3 更新 Header 以包含快速切換

## 3. 樣式設定
- [ ] 3.1 定義深色主題調色盤
- [ ] 3.2 更新元件以使用 CSS 變數
```

### 4. 實作

```
您：/opsx:apply

AI： 正在處理任務...
     ✓ 1.1 已建立具有亮/暗狀態的 ThemeContext
     ✓ 1.2 已將 CSS 自訂屬性新增至 globals.css
     ✓ 1.3 已實作 localStorage 持久化
     ✓ 2.1 已建立 ThemeToggle 元件
     ...
     所有任務已完成！
```

在實作期間，如果您發現設計需要調整，只需更新成品並繼續即可。

### 5. 封存

```
您：/opsx:archive

AI： 正在封存 add-dark-mode...
     ✓ 已將規格合併至 openspec/specs/ui/spec.md
     ✓ 已移動至 openspec/changes/archive/2025-01-24-add-dark-mode/
     完成！準備好進行下一個功能。
```

您的差異規格現在已成為主規格的一部分，記錄了您的系統如何運作。

## 驗證與檢閱

使用 CLI 檢查您的變更：

```bash
# 列出作用中的變更
openspec list

# 檢視變更詳細資訊
openspec show add-dark-mode

# 驗證規格格式
openspec validate add-dark-mode

# 互動式儀表板
openspec view
```

## 後續步驟

- [工作流程](workflows.md) — 常見模式以及何時使用各個指令
- [指令](commands.md) — 所有斜線指令的完整參考
- [核心概念](concepts.md) — 深入瞭解規格、變更和 schema
- [自訂](customization.md) — 讓 OpenSpec 按您的方式運作
